<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Módulo 1: Observación y Gesto - LMS UAH</title>
    
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.3/font/bootstrap-icons.min.css">
    
    <style>
        :root {
            --primary-dark: #2c5f66;
            --primary-light: #e8a2b8;
            --dark: #1a1a1a;
            --success: #4CAF50;
            --warning: #FFC107;
            --danger: #f44336;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            background: #f8f9fa;
        }

        .header-uah {
            background: linear-gradient(135deg, var(--primary-dark), var(--dark));
            color: white;
            padding: 1rem 0;
            position: sticky;
            top: 0;
            z-index: 1030;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }

        .sidebar-lesson {
            background: white;
            border-radius: 12px;
            padding: 1.5rem;
            position: sticky;
            top: 90px;
            max-height: calc(100vh - 110px);
            overflow-y: auto;
        }

        .lesson-link {
            display: flex;
            align-items: center;
            gap: 1rem;
            padding: 0.75rem;
            border-radius: 8px;
            text-decoration: none;
            color: var(--dark);
            transition: all 0.3s;
            cursor: pointer;
            margin-bottom: 0.5rem;
        }

        .lesson-link:hover {
            background: #f8f9fa;
        }

        .lesson-link.active {
            background: linear-gradient(135deg, var(--primary-dark), var(--primary-light));
            color: white;
        }

        .lesson-number {
            width: 30px;
            height: 30px;
            background: #e9ecef;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: bold;
            font-size: 0.85rem;
            flex-shrink: 0;
        }

        .lesson-link.active .lesson-number {
            background: rgba(255,255,255,0.3);
            color: white;
        }

        .lesson-link.completed .lesson-number {
            background: var(--success);
            color: white;
        }

        .lesson-link.completed::after {
            content: '✓';
            margin-left: auto;
            font-weight: bold;
        }

        .progress-uah {
            height: 30px;
            background: #e9ecef;
            border-radius: 15px;
            overflow: hidden;
            margin-bottom: 1.5rem;
        }

        .progress-bar-uah {
            height: 100%;
            background: linear-gradient(90deg, var(--primary-dark), var(--primary-light));
            display: flex;
            align-items: center;
            justify-content: flex-end;
            padding-right: 1rem;
            color: white;
            font-weight: bold;
            transition: width 0.5s ease;
        }

        .video-container {
            background: #000;
            border-radius: 8px;
            aspect-ratio: 16/9;
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
        }

        .image-placeholder {
            border: 2px dashed #adb5bd;
            border-radius: 8px;
            aspect-ratio: 3/4;
            background: #e9ecef;
            display: flex;
            align-items: center;
            justify-content: center;
            color: #6c757d;
            font-size: 0.85rem;
            text-align: center;
            padding: 1rem;
        }

        .accordion-button:not(.collapsed) {
            background-color: var(--primary-dark);
            color: white;
        }

        .accordion-button:focus {
            box-shadow: 0 0 0 0.25rem rgba(44, 95, 102, 0.25);
        }

        .eval-option {
            padding: 0.75rem;
            background: white;
            border: 2px solid #dee2e6;
            border-radius: 8px;
            cursor: pointer;
            transition: all 0.3s;
            margin-bottom: 0.5rem;
        }

        .eval-option:hover {
            border-color: var(--primary-light);
            background: #f8f9fa;
        }

        .eval-option.selected {
            border-color: var(--primary-dark);
            background: rgba(44, 95, 102, 0.1);
        }

        .eval-option.correct {
            border-color: var(--success);
            background: rgba(76, 175, 80, 0.1);
        }

        .eval-option.incorrect {
            border-color: var(--danger);
            background: rgba(244, 67, 54, 0.1);
        }

        .reference-text {
            font-size: 0.85rem;
            color: #6c757d;
            border-left: 3px solid var(--primary-light);
            padding-left: 1rem;
            margin-top: 1rem;
        }

        @media (max-width: 991px) {
            .sidebar-lesson {
                position: static;
                margin-bottom: 1.5rem;
            }
        }
    </style>
</head>
<body>
    <script src="auth.js"></script>

    <header class="header-uah">
        <div class="container-fluid">
            <div class="row align-items-center g-2">
                <div class="col-auto">
                    <a href="index.html" class="text-white text-decoration-none">
                        <i class="bi bi-arrow-left me-2"></i><span class="d-none d-md-inline">Volver</span>
                    </a>
                </div>
                <div class="col text-center">
                    <h1 class="h5 h-md-4 mb-0">Módulo 1: Observación y Gesto</h1>
                </div>
                <div class="col-auto">
                    <span class="badge bg-light text-dark" id="progressText">0%</span>
                </div>
            </div>
        </div>
    </header>

    <div class="container-fluid py-3 py-md-4">
        <div class="row">
            <aside class="col-lg-3">
                <div class="sidebar-lesson">
                    <h5 class="mb-3"><i class="bi bi-book me-2"></i>Lecciones</h5>
                    <a class="lesson-link active" data-lesson="1" onclick="loadLesson(1)">
                        <span class="lesson-number">1</span>
                        <span class="flex-grow-1">Fundamentos del Croquis</span>
                    </a>
                    <a class="lesson-link" data-lesson="2" onclick="loadLesson(2)">
                        <span class="lesson-number">2</span>
                        <span class="flex-grow-1">Proporciones</span>
                    </a>
                    <a class="lesson-link" data-lesson="3" onclick="loadLesson(3)">
                        <span class="lesson-number">3</span>
                        <span class="flex-grow-1">Balance</span>
                    </a>
                </div>
            </aside>

            <main class="col-lg-9">
                <div class="bg-white rounded-3 p-3 p-md-4 shadow-sm">
                    <div class="progress-uah">
                        <div class="progress-bar-uah" id="moduleProgress" style="width: 0%">
                            <span>0%</span>
                        </div>
                    </div>

                    <div class="border-bottom pb-3 mb-4">
                        <h2 class="h4 mb-2" id="lessonTitle">Lección 1</h2>
                        <div class="d-flex flex-wrap gap-3 text-muted small" id="lessonMeta"></div>
                    </div>

                    <div id="lessonContent"></div>

                    <div class="d-flex flex-wrap justify-content-between gap-2 pt-4 mt-4 border-top">
                        <button class="btn btn-outline-primary" id="prevButton" onclick="goToPreviousLesson()">
                            <i class="bi bi-arrow-left me-1"></i>Anterior
                        </button>
                        <button class="btn btn-success" onclick="completeLesson()" id="completeButton">
                            <i class="bi bi-check-circle me-1"></i>Completar
                        </button>
                        <button class="btn btn-primary" id="nextButton" onclick="goToNextLesson()">
                            Siguiente<i class="bi bi-arrow-right ms-1"></i>
                        </button>
                    </div>
                </div>
            </main>
        </div>
    </div>

    <div class="toast-container position-fixed bottom-0 end-0 p-3">
        <div id="notificationToast" class="toast" role="alert">
            <div class="toast-header">
                <i class="bi bi-check-circle-fill text-success me-2" id="toastIcon"></i>
                <strong class="me-auto">Notificación</strong>
                <button type="button" class="btn-close" data-bs-dismiss="toast"></button>
            </div>
            <div class="toast-body" id="toastBody"></div>
        </div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"></script>

    <script>
        let currentUser = null;
        let currentLesson = 1;
        let moduleProgress = 0;
        let completedLessons = [];
        let evaluationScores = {};
        window.evaluationAnswers = {};

        const lessonsContent = {
            1: {
                title: 'Fundamentos del Croquis Rápido',
                meta: '<span><i class="bi bi-clock me-1"></i>45 min</span><span><i class="bi bi-book me-1"></i>Observación</span>',
                content: `
                    <div class="alert alert-info">
                        <h6 class="alert-heading"><i class="bi bi-bullseye me-2"></i>Objetivos de Aprendizaje</h6>
                        <ul class="mb-0 small">
                            <li>Aplicar técnicas de observación directa para capturar línea de acción (2 min)</li>
                            <li>Identificar eje central y puntos de peso en figuras humanas</li>
                        </ul>
                    </div>

                    <div class="card mb-3">
                        <div class="card-header bg-primary text-white">
                            <i class="bi bi-play-circle me-2"></i>Video Explicativo (2-3 min)
                        </div>
                        <div class="card-body p-0">
                            <div class="video-container">
                                <div class="text-center p-3">
                                    <i class="bi bi-camera-video" style="font-size: 3rem;"></i>
                                    <p class="mt-2 mb-0 small">Insertar: video_leccion1.mp4</p>
                                </div>
                            </div>
                        </div>
                    </div>

                    <div class="accordion mb-4" id="accordionLesson1">
                        <div class="accordion-item">
                            <h2 class="accordion-header">
                                <button class="accordion-button" type="button" data-bs-toggle="collapse" data-bs-target="#collapse1">
                                    <i class="bi bi-1-circle me-2"></i>¿Qué es la Línea de Acción?
                                </button>
                            </h2>
                            <div id="collapse1" class="accordion-collapse collapse show" data-bs-parent="#accordionLesson1">
                                <div class="accordion-body">
                                    <p>La línea de acción es el eje imaginario que atraviesa toda la figura, definiendo la dirección y energía del movimiento. No es una línea que dibujas literalmente, sino una guía mental para capturar la esencia del gesto.</p>
                                    
                                    <h6 class="mt-3">Características fundamentales:</h6>
                                    <ul>
                                        <li><strong>Recorrido:</strong> Atraviesa desde la cabeza hasta el pie de apoyo</li>
                                        <li><strong>Forma:</strong> Recta en poses estáticas, curva en poses dinámicas</li>
                                        <li><strong>Función:</strong> Define la dirección principal del movimiento corporal</li>
                                    </ul>

                                    <div class="reference-text">
                                        <small>Loomis, A. (1943). <em>Figure drawing for all it's worth</em>. Viking Press.</small>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <div class="accordion-item">
                            <h2 class="accordion-header">
                                <button class="accordion-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#collapse2">
                                    <i class="bi bi-2-circle me-2"></i>Peso y Punto de Apoyo
                                </button>
                            </h2>
                            <div id="collapse2" class="accordion-collapse collapse" data-bs-parent="#accordionLesson1">
                                <div class="accordion-body">
                                    <p>El peso corporal se distribuye a través de los puntos de apoyo. Identificar dónde se concentra el peso es fundamental para crear figuras creíbles.</p>
                                    
                                    <h6 class="mt-3">Conceptos clave:</h6>
                                    <ul>
                                        <li><strong>Punto de peso:</strong> Zona donde se concentra el apoyo principal</li>
                                        <li><strong>Pie de apoyo:</strong> Extremidad que sostiene la mayor parte del peso</li>
                                        <li><strong>Centro de gravedad:</strong> Punto imaginario desde donde cae una línea vertical al suelo</li>
                                        <li><strong>Contrapposto:</strong> Peso concentrado en un lado, relajación en el otro</li>
                                    </ul>

                                    <div class="alert alert-warning mt-3">
                                        <small><i class="bi bi-lightbulb me-2"></i><strong>Regla práctica:</strong> La línea vertical desde el centro de la cabeza debe caer dentro del polígono de apoyo (área entre los pies) para mantener equilibrio visual.</small>
                                    </div>

                                    <div class="reference-text">
                                        <small>Bridgman, G. B. (1920). <em>Constructive anatomy</em>. Dover Publications.</small>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <div class="accordion-item">
                            <h2 class="accordion-header">
                                <button class="accordion-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#collapse3">
                                    <i class="bi bi-3-circle me-2"></i>Proceso del Croquis de 2 Minutos
                                </button>
                            </h2>
                            <div id="collapse3" class="accordion-collapse collapse" data-bs-parent="#accordionLesson1">
                                <div class="accordion-body">
                                    <p>El croquis rápido no busca perfección, sino capturar la energía y dirección del cuerpo.</p>
                                    
                                    <h6 class="mt-3">División del tiempo:</h6>
                                    <div class="row g-3">
                                        <div class="col-md-4">
                                            <div class="card bg-light h-100">
                                                <div class="card-body text-center">
                                                    <h6 class="text-primary">0-20 seg</h6>
                                                    <p class="small mb-0">Observa e identifica mentalmente la línea de acción</p>
                                                </div>
                                            </div>
                                        </div>
                                        <div class="col-md-4">
                                            <div class="card bg-light h-100">
                                                <div class="card-body text-center">
                                                    <h6 class="text-primary">20-60 seg</h6>
                                                    <p class="small mb-0">Traza línea de acción + marca punto de apoyo</p>
                                                </div>
                                            </div>
                                        </div>
                                        <div class="col-md-4">
                                            <div class="card bg-light h-100">
                                                <div class="card-body text-center">
                                                    <h6 class="text-primary">60-120 seg</h6>
                                                    <p class="small mb-0">Indica masa corporal con trazos simples</p>
                                                </div>
                                            </div>
                                        </div>
                                    </div>

                                    <div class="alert alert-danger mt-3">
                                        <small><i class="bi bi-x-circle me-2"></i><strong>Evita:</strong> Borrar, agregar detalles, o intentar perfeccionar. El objetivo es capturar el gesto, no crear un dibujo terminado.</small>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>

                    <div class="card bg-light mb-4">
                        <div class="card-header bg-success text-white">
                            <i class="bi bi-pencil me-2"></i>Ejercicio 1: 3 Croquis de 2 Minutos
                        </div>
                        <div class="card-body">
                            <p><strong>Objetivo:</strong> Capturar línea de acción y peso en 3 poses diferentes</p>
                            
                            <p class="mb-2"><strong>Materiales:</strong></p>
                            <ul class="small">
                                <li>3 hojas de papel (puede ser reciclado)</li>
                                <li>Lápiz o carboncillo</li>
                                <li>Cronómetro</li>
                            </ul>
                            
                            <p class="mb-2 mt-3"><strong>Referencias fotográficas:</strong></p>
                            <div class="row g-2 mb-3">
                                <div class="col-4">
                                    <div class="image-placeholder">
                                        ref1_figura_pie.jpg
                                    </div>
                                </div>
                                <div class="col-4">
                                    <div class="image-placeholder">
                                        ref2_pose_dinamica.jpg
                                    </div>
                                </div>
                                <div class="col-4">
                                    <div class="image-placeholder">
                                        ref3_contrapposto.jpg
                                    </div>
                                </div>
                            </div>

                            <p class="mb-0 small"><strong>Instrucciones:</strong> Configura cronómetro a 2 minutos. No borres ni corrijas. Fotografía cada resultado para entregar.</p>
                        </div>
                    </div>

                    <div class="card border-warning">
                        <div class="card-header bg-warning">
                            <i class="bi bi-clipboard-check me-2"></i>Evaluación Lección 1
                        </div>
                        <div class="card-body">
                            <p class="mb-2"><strong>1. ¿Cuál es el objetivo principal de un croquis de 2 minutos?</strong></p>
                            <div class="eval-options" data-question="1" data-correct="2">
                                <div class="eval-option" onclick="selectEvalOption(this, 1, 1)">
                                    A) Lograr un dibujo detallado y realista
                                </div>
                                <div class="eval-option" onclick="selectEvalOption(this, 2, 1)">
                                    B) Capturar la energía, dirección y peso del cuerpo
                                </div>
                                <div class="eval-option" onclick="selectEvalOption(this, 3, 1)">
                                    C) Practicar técnicas de sombreado
                                </div>
                            </div>

                            <p class="mb-2 mt-3"><strong>2. ¿Qué debes identificar PRIMERO antes de comenzar a dibujar?</strong></p>
                            <div class="eval-options" data-question="2" data-correct="1">
                                <div class="eval-option" onclick="selectEvalOption(this, 1, 1)">
                                    A) La línea de acción y el punto de apoyo
                                </div>
                                <div class="eval-option" onclick="selectEvalOption(this, 2, 1)">
                                    B) Los detalles del rostro
                                </div>
                                <div class="eval-option" onclick="selectEvalOption(this, 3, 1)">
                                    C) La textura de la ropa
                                </div>
                            </div>

                            <p class="mb-2 mt-3"><strong>3. En el croquis rápido, ¿qué actitud es la más apropiada?</strong></p>
                            <div class="eval-options" data-question="3" data-correct="3">
                                <div class="eval-option" onclick="selectEvalOption(this, 1, 1)">
                                    A) Borrar constantemente hasta lograr perfección
                                </div>
                                <div class="eval-option" onclick="selectEvalOption(this, 2, 1)">
                                    B) Comenzar con detalles pequeños
                                </div>
                                <div class="eval-option" onclick="selectEvalOption(this, 3, 1)">
                                    C) No borrar, enfocarse en capturar el gesto
                                </div>
                            </div>

                            <div class="text-center mt-3">
                                <button class="btn btn-warning" onclick="submitEvaluation(1)">
                                    <i class="bi bi-send me-2"></i>Enviar Evaluación
                                </button>
                            </div>
                            <div id="evalResults1" class="alert mt-3" style="display: none;">
                                <strong>Resultado:</strong> <span id="evalScore1"></span>
                            </div>
                        </div>
                    </div>
                `
            },
            2: {
                title: 'Proporciones por Observación',
                meta: '<span><i class="bi bi-clock me-1"></i>50 min</span><span><i class="bi bi-book me-1"></i>Medición</span>',
                content: `
                    <div class="alert alert-info">
                        <h6 class="alert-heading"><i class="bi bi-bullseye me-2"></i>Objetivos de Aprendizaje</h6>
                        <ul class="mb-0 small">
                            <li>Medir proporciones por comparación visual directa</li>
                            <li>Aplicar proporciones observadas en 2 figuras de 15 minutos</li>
                        </ul>
                    </div>

                    <div class="accordion mb-4" id="accordionLesson2">
                        <div class="accordion-item">
                            <h2 class="accordion-header">
                                <button class="accordion-button" type="button" data-bs-toggle="collapse" data-bs-target="#collapse2_1">
                                    <i class="bi bi-1-circle me-2"></i>Medición Visual sin Fórmulas
                                </button>
                            </h2>
                            <div id="collapse2_1" class="accordion-collapse collapse show" data-bs-parent="#accordionLesson2">
                                <div class="accordion-body">
                                    <p>A diferencia de memorizar fórmulas numéricas, la medición visual te enseña a <strong>observar y comparar</strong> proporciones directamente de cada figura específica.</p>
                                    
                                    <h6 class="mt-3">Técnica del Lápiz como Regla:</h6>
                                    <ol>
                                        <li>Extiende tu brazo completamente con el lápiz vertical</li>
                                        <li>Cierra un ojo para eliminar percepción de profundidad</li>
                                        <li>Alinea la punta del lápiz con la parte superior de la cabeza</li>
                                        <li>Marca con tu pulgar dónde termina la barbilla</li>
                                        <li>Esta distancia es tu unidad de medida base</li>
                                        <li>Compara cuántas veces cabe en el resto del cuerpo</li>
                                    </ol>

                                    <div class="alert alert-success mt-3">
                                        <small><i class="bi bi-star me-2"></i><strong>Ventaja:</strong> Esta técnica funciona con cualquier persona, en cualquier pose, desde cualquier ángulo.</small>
                                    </div>

                                    <div class="reference-text">
                                        <small>Nicolaïdes, K. (1941). <em>The natural way to draw</em>. Houghton Mifflin.</small>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <div class="accordion-item">
                            <h2 class="accordion-header">
                                <button class="accordion-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#collapse2_2">
                                    <i class="bi bi-2-circle me-2"></i>Consistencia Interna
                                </button>
                            </h2>
                            <div id="collapse2_2" class="accordion-collapse collapse" data-bs-parent="#accordionLesson2">
                                <div class="accordion-body">
                                    <p>La consistencia interna significa que todas las partes del cuerpo se relacionan proporcionalmente entre sí dentro de tu dibujo específico.</p>
                                    
                                    <h6 class="mt-3">Regla de oro:</h6>
                                    <p class="bg-light p-3 rounded">Si la cabeza mide <strong>X</strong> en tu dibujo, todo lo demás debe relacionarse con ese <strong>X</strong> que observas, no con números memorizados.</p>

                                    <div class="alert alert-warning mt-3">
                                        <small><i class="bi bi-exclamation-triangle me-2"></i><strong>Error común:</strong> Aplicar "8 cabezas" mecánicamente a todas las figuras. Cada persona es diferente, cada pose modifica las proporciones visuales.</small>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <div class="accordion-item">
                            <h2 class="accordion-header">
                                <button class="accordion-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#collapse2_3">
                                    <i class="bi bi-3-circle me-2"></i>Proceso de Figura de 15 Minutos
                                </button>
                            </h2>
                            <div id="collapse2_3" class="accordion-collapse collapse" data-bs-parent="#accordionLesson2">
                                <div class="accordion-body">
                                    <div class="row g-3">
                                        <div class="col-md-3">
                                            <div class="card bg-light h-100">
                                                <div class="card-body text-center">
                                                    <h6 class="text-primary">0-2 min</h6>
                                                    <p class="small mb-0">Observa sin dibujar</p>
                                                </div>
                                            </div>
                                        </div>
                                        <div class="col-md-3">
                                            <div class="card bg-light h-100">
                                                <div class="card-body text-center">
                                                    <h6 class="text-primary">2-3 min</h6>
                                                    <p class="small mb-0">Mide visualmente</p>
                                                </div>
                                            </div>
                                        </div>
                                        <div class="col-md-3">
                                            <div class="card bg-light h-100">
                                                <div class="card-body text-center">
                                                    <h6 class="text-primary">3-13 min</h6>
                                                    <p class="small mb-0">Construye la figura</p>
                                                </div>
                                            </div>
                                        </div>
                                        <div class="col-md-3">
                                            <div class="card bg-light h-100">
                                                <div class="card-body text-center">
                                                    <h6 class="text-primary">13-15 min</h6>
                                                    <p class="small mb-0">Ajustes finales</p>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>

                    <div class="card bg-light mb-4">
                        <div class="card-header bg-success text-white">
                            <i class="bi bi-pencil me-2"></i>Ejercicio 2: 2 Figuras de 15 Minutos
                        </div>
                        <div class="card-body">
                            <p><strong>Objetivo:</strong> Aplicar medición visual en figuras completas</p>
                            
                            <p class="mb-2"><strong>Materiales:</strong></p>
                            <ul class="small">
                                <li>2 hojas de papel tamaño carta</li>
                                <li>Lápiz HB o 2B</li>
                                <li>Goma de borrar (solo ajustes mayores)</li>
                                <li>Cronómetro</li>
                            </ul>
                            
                            <p class="mb-2 mt-3"><strong>Referencias fotográficas:</strong></p>
                            <div class="row g-2 mb-3">
                                <div class="col-6">
                                    <div class="image-placeholder">
                                        ref4_figura_frontal.jpg
                                    </div>
                                </div>
                                <div class="col-6">
                                    <div class="image-placeholder">
                                        ref5_figura_perfil.jpg
                                    </div>
                                </div>
                            </div>

                            <p class="mb-0 small"><strong>Instrucciones:</strong> 15 minutos por figura. Mide constantemente con el método del lápiz. Fotografía resultados.</p>
                        </div>
                    </div>

                    <div class="card border-warning">
                        <div class="card-header bg-warning">
                            <i class="bi bi-clipboard-check me-2"></i>Evaluación Lección 2
                        </div>
                        <div class="card-body">
                            <p class="mb-2"><strong>1. ¿Cuál es la técnica correcta para medir proporciones visualmente?</strong></p>
                            <div class="eval-options" data-question="1" data-correct="2">
                                <div class="eval-option" onclick="selectEvalOption(this, 1, 2)">
                                    A) Memorizar que el cuerpo mide exactamente 8 cabezas
                                </div>
                                <div class="eval-option" onclick="selectEvalOption(this, 2, 2)">
                                    B) Extender brazo, usar lápiz como regla, comparar partes
                                </div>
                                <div class="eval-option" onclick="selectEvalOption(this, 3, 2)">
                                    C) Usar regla física sobre la fotografía
                                </div>
                            </div>

                            <p class="mb-2 mt-3"><strong>2. ¿Qué significa "consistencia interna"?</strong></p>
                            <div class="eval-options" data-question="2" data-correct="3">
                                <div class="eval-option" onclick="selectEvalOption(this, 1, 2)">
                                    A) Todas las líneas tienen el mismo grosor
                                </div>
                                <div class="eval-option" onclick="selectEvalOption(this, 2, 2)">
                                    B) El dibujo está completamente terminado
                                </div>
                                <div class="eval-option" onclick="selectEvalOption(this, 3, 2)">
                                    C) Todas las partes se relacionan proporcionalmente
                                </div>
                            </div>

                            <p class="mb-2 mt-3"><strong>3. Al construir una figura de 15 minutos, ¿qué hacer PRIMERO?</strong></p>
                            <div class="eval-options" data-question="3" data-correct="1">
                                <div class="eval-option" onclick="selectEvalOption(this, 1, 2)">
                                    A) Observar y medir visualmente las proporciones
                                </div>
                                <div class="eval-option" onclick="selectEvalOption(this, 2, 2)">
                                    B) Dibujar detalles del rostro
                                </div>
                                <div class="eval-option" onclick="selectEvalOption(this, 3, 2)">
                                    C) Sombrear el fondo
                                </div>
                            </div>

                            <div class="text-center mt-3">
                                <button class="btn btn-warning" onclick="submitEvaluation(2)">
                                    <i class="bi bi-send me-2"></i>Enviar Evaluación
                                </button>
                            </div>
                            <div id="evalResults2" class="alert mt-3" style="display: none;">
                                <strong>Resultado:</strong> <span id="evalScore2"></span>
                            </div>
                        </div>
                    </div>
                `
            },
            3: {
                title: 'Composición y Balance',
                meta: '<span><i class="bi bi-clock me-1"></i>55 min</span><span><i class="bi bi-book me-1"></i>Equilibrio</span>',
                content: `
                    <div class="alert alert-info">
                        <h6 class="alert-heading"><i class="bi bi-bullseye me-2"></i>Objetivos de Aprendizaje</h6>
                        <ul class="mb-0 small">
                            <li>Identificar contrapposto (distribución de peso asimétrica)</li>
                            <li>Crear 3 croquis con comprensión de balance corporal</li>
                        </ul>
                    </div>

                    <div class="accordion mb-4" id="accordionLesson3">
                        <div class="accordion-item">
                            <h2 class="accordion-header">
                                <button class="accordion-button" type="button" data-bs-toggle="collapse" data-bs-target="#collapse3_1">
                                    <i class="bi bi-1-circle me-2"></i>¿Qué es el Contrapposto?
                                </button>
                            </h2>
                            <div id="collapse3_1" class="accordion-collapse collapse show" data-bs-parent="#accordionLesson3">
                                <div class="accordion-body">
                                    <p>El contrapposto es una pose natural donde el peso se distribuye asimétricamente: cuando una cadera sube, el hombro opuesto tiende a bajar.</p>
                                    
                                    <div class="row g-3 mt-3">
                                        <div class="col-md-6">
                                            <div class="card border-primary">
                                                <div class="card-header bg-primary text-white">Lado con Peso</div>
                                                <div class="card-body">
                                                    <ul class="small mb-0">
                                                        <li>Cadera elevada</li>
                                                        <li>Pierna tensa/recta</li>
                                                        <li>Hombro ligeramente bajo</li>
                                                        <li>Músculos contraídos</li>
                                                    </ul>
                                                </div>
                                            </div>
                                        </div>
                                        <div class="col-md-6">
                                            <div class="card border-success">
                                                <div class="card-header bg-success text-white">Lado Relajado</div>
                                                <div class="card-body">
                                                    <ul class="small mb-0">
                                                        <li>Cadera descendida</li>
                                                        <li>Pierna doblada/relajada</li>
                                                        <li>Hombro ligeramente alto</li>
                                                        <li>Músculos distendidos</li>
                                                    </ul>
                                                </div>
                                            </div>
                                        </div>
                                    </div>

                                    <div class="reference-text mt-3">
                                        <small>Richer, P. (1890). <em>Artistic anatomy</em>. Watson-Guptill Publications.</small>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <div class="accordion-item">
                            <h2 class="accordion-header">
                                <button class="accordion-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#collapse3_2">
                                    <i class="bi bi-2-circle me-2"></i>Polígono de Apoyo
                                </button>
                            </h2>
                            <div id="collapse3_2" class="accordion-collapse collapse" data-bs-parent="#accordionLesson3">
                                <div class="accordion-body">
                                    <p>Para que una figura se vea equilibrada, la línea vertical desde el centro de la cabeza debe caer dentro del polígono de apoyo (área entre los pies).</p>
                                    
                                    <div class="alert alert-success mt-3">
                                        <small><i class="bi bi-check-circle me-2"></i><strong>Regla visual:</strong> Si la línea cae fuera del polígono, la figura se verá inestable.</small>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <div class="accordion-item">
                            <h2 class="accordion-header">
                                <button class="accordion-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#collapse3_3">
                                    <i class="bi bi-3-circle me-2"></i>Ejes de Hombros y Caderas
                                </button>
                            </h2>
                            <div id="collapse3_3" class="accordion-collapse collapse" data-bs-parent="#accordionLesson3">
                                <div class="accordion-body">
                                    <p>Los ejes horizontales son fundamentales para entender el balance.</p>
                                    
                                    <ol>
                                        <li>Observa inclinación de hombros</li>
                                        <li>Observa inclinación de caderas</li>
                                        <li>En contrapposto, tienen inclinaciones opuestas</li>
                                        <li>Marca estas líneas como guías</li>
                                    </ol>

                                    <div class="alert alert-info mt-3">
                                        <small><i class="bi bi-palette me-2"></i><strong>Consejo:</strong> Usa un lápiz de color diferente para marcar estos ejes temporalmente.</small>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>

                    <div class="card bg-light mb-4">
                        <div class="card-header bg-success text-white">
                            <i class="bi bi-pencil me-2"></i>Ejercicio 3: 3 Croquis de Balance (5 min c/u)
                        </div>
                        <div class="card-body">
                            <p><strong>Objetivo:</strong> Capturar distribución de peso y balance</p>
                            
                            <p class="mb-2"><strong>Materiales:</strong></p>
                            <ul class="small">
                                <li>3 hojas de papel</li>
                                <li>Lápiz + lápiz de color (opcional)</li>
                                <li>Cronómetro</li>
                            </ul>
                            
                            <p class="mb-2 mt-3"><strong>Referencias fotográficas:</strong></p>
                            <div class="row g-2 mb-3">
                                <div class="col-4">
                                    <div class="image-placeholder">
                                        ref6_contrapposto.jpg
                                    </div>
                                </div>
                                <div class="col-4">
                                    <div class="image-placeholder">
                                        ref7_peso_asimetrico.jpg
                                    </div>
                                </div>
                                <div class="col-4">
                                    <div class="image-placeholder">
                                        ref8_balance_dinamico.jpg
                                    </div>
                                </div>
                            </div>

                            <p class="mb-0 small"><strong>Proceso:</strong> Min 1: observa peso | Min 2: marca ejes | Min 3-4: línea + masa | Min 5: extremidades</p>
                        </div>
                    </div>

                    <div class="card border-warning">
                        <div class="card-header bg-warning">
                            <i class="bi bi-clipboard-check me-2"></i>Evaluación Final Módulo 1
                        </div>
                        <div class="card-body">
                            <p class="mb-2"><strong>1. Si la cadera derecha está elevada, ¿qué sucede con el hombro derecho?</strong></p>
                            <div class="eval-options" data-question="1" data-correct="2">
                                <div class="eval-option" onclick="selectEvalOption(this, 1, 3)">
                                    A) También se eleva
                                </div>
                                <div class="eval-option" onclick="selectEvalOption(this, 2, 3)">
                                    B) Tiende a descender (opuesto)
                                </div>
                                <div class="eval-option" onclick="selectEvalOption(this, 3, 3)">
                                    C) Permanece horizontal
                                </div>
                            </div>

                            <p class="mb-2 mt-3"><strong>2. ¿Dónde debe caer la línea vertical para equilibrio?</strong></p>
                            <div class="eval-options" data-question="2" data-correct="3">
                                <div class="eval-option" onclick="selectEvalOption(this, 1, 3)">
                                    A) Centro exacto entre pies
                                </div>
                                <div class="eval-option" onclick="selectEvalOption(this, 2, 3)">
                                    B) Siempre pie derecho
                                </div>
                                <div class="eval-option" onclick="selectEvalOption(this, 3, 3)">
                                    C) Dentro del polígono de apoyo
                                </div>
                            </div>

                            <p class="mb-2 mt-3"><strong>3. ¿Qué marcar PRIMERO en croquis de balance?</strong></p>
                            <div class="eval-options" data-question="3" data-correct="1">
                                <div class="eval-option" onclick="selectEvalOption(this, 1, 3)">
                                    A) Ejes de hombros y caderas
                                </div>
                                <div class="eval-option" onclick="selectEvalOption(this, 2, 3)">
                                    B) Dedos de manos
                                </div>
                                <div class="eval-option" onclick="selectEvalOption(this, 3, 3)">
                                    C) Sombreado del torso
                                </div>
                            </div>

                            <div class="text-center mt-3">
                                <button class="btn btn-warning" onclick="submitEvaluation(3)">
                                    <i class="bi bi-send me-2"></i>Enviar Evaluación
                                </button>
                            </div>
                            <div id="evalResults3" class="alert mt-3" style="display: none;">
                                <strong>Resultado:</strong> <span id="evalScore3"></span>
                            </div>
                        </div>
                    </div>

                    <div class="alert alert-success mt-4">
                        <h6><i class="bi bi-trophy me-2"></i>Portfolio Módulo 1</h6>
                        <p class="small mb-2"><strong>Entregables:</strong></p>
                        <ul class="small mb-0">
                            <li>3 croquis de 2 min (Lección 1)</li>
                            <li>2 figuras de 15 min (Lección 2)</li>
                            <li>3 croquis de 5 min (Lección 3)</li>
                            <li>3 evaluaciones aprobadas</li>
                        </ul>
                    </div>

                    <div class="card border-primary mt-3">
                        <div class="card-header bg-primary text-white">
                            <i class="bi bi-cloud-upload me-2"></i>Entrega
                        </div>
                        <div class="card-body text-center">
                            <a href="https://forms.gle/URL_FORMULARIO" class="btn btn-primary" target="_blank">
                                <i class="bi bi-box-arrow-up-right me-2"></i>Subir Trabajos
                            </a>
                        </div>
                    </div>
                `
            }
        };

        function selectEvalOption(element, optionNumber, lessonNum) {
            const container = element.parentElement;
            const question = container.getAttribute('data-question');
            container.querySelectorAll('.eval-option').forEach(opt => opt.classList.remove('selected'));
            element.classList.add('selected');
            if (!window.evaluationAnswers[lessonNum]) window.evaluationAnswers[lessonNum] = {};
            window.evaluationAnswers[lessonNum][question] = optionNumber;
        }

        function submitEvaluation(lessonNum) {
            const answers = window.evaluationAnswers[lessonNum] || {};
            const containers = document.querySelectorAll('.eval-options[data-question]');
            let correctCount = 0, totalQuestions = 0;
            
            containers.forEach(container => {
                const question = container.getAttribute('data-question');
                const correctAnswer = parseInt(container.getAttribute('data-correct'));
                const userAnswer = answers[question];
                totalQuestions++;
                
                container.querySelectorAll('.eval-option').forEach((opt, index) => {
                    opt.style.pointerEvents = 'none';
                    opt.classList.remove('correct', 'incorrect');
                    if (index + 1 === correctAnswer) opt.classList.add('correct');
                    if (index + 1 === userAnswer && userAnswer !== correctAnswer) opt.classList.add('incorrect');
                });
                
                if (userAnswer === correctAnswer) correctCount++;
            });
            
            const percentage = Math.round((correctCount / totalQuestions) * 100);
            const passed = correctCount >= 2;
            
            evaluationScores[lessonNum] = { correct: correctCount, total: totalQuestions, percentage, passed };
            
            const resultsDiv = document.getElementById(`evalResults${lessonNum}`);
            const scoreSpan = document.getElementById(`evalScore${lessonNum}`);
            scoreSpan.innerHTML = `${correctCount}/${totalQuestions} (${percentage}%) - ${passed ? '<span class="text-success">Aprobado</span>' : '<span class="text-danger">Revisar</span>'}`;
            resultsDiv.style.display = 'block';
            resultsDiv.className = passed ? 'alert alert-success' : 'alert alert-warning';
            showNotification(passed ? 'Evaluación aprobada' : 'Revisa contenido', passed ? 'success' : 'warning');
            saveProgress();
        }

        function loadLesson(lessonNumber) {
            currentLesson = lessonNumber;
            document.querySelectorAll('.lesson-link').forEach(link => {
                link.classList.remove('active');
                if (parseInt(link.getAttribute('data-lesson')) === lessonNumber) link.classList.add('active');
            });
            const lesson = lessonsContent[lessonNumber];
            if (lesson) {
                document.getElementById('lessonTitle').textContent = lesson.title;
                document.getElementById('lessonMeta').innerHTML = lesson.meta;
                document.getElementById('lessonContent').innerHTML = lesson.content;
            }
            updateNavigationButtons();
            window.scrollTo({ top: 0, behavior: 'smooth' });
        }

        function updateNavigationButtons() {
            document.getElementById('prevButton').disabled = currentLesson <= 1;
            document.getElementById('nextButton').style.display = currentLesson >= 3 ? 'none' : 'inline-block';
            const btn = document.getElementById('completeButton');
            if (completedLessons.includes(currentLesson)) {
                btn.innerHTML = '<i class="bi bi-check-circle-fill me-1"></i>Completada';
                btn.disabled = true;
            } else {
                btn.innerHTML = '<i class="bi bi-check-circle me-1"></i>Completar';
                btn.disabled = false;
            }
        }

        function goToPreviousLesson() { if (currentLesson > 1) loadLesson(currentLesson - 1); }
        function goToNextLesson() { if (currentLesson < 3) loadLesson(currentLesson + 1); }

        async function completeLesson() {
            if (completedLessons.includes(currentLesson)) return;
            completedLessons.push(currentLesson);
            moduleProgress = Math.round((completedLessons.length / 3) * 100);
            await saveProgress();
            updateProgressDisplay();
            updateSidebarProgress();
            updateNavigationButtons();
            if (moduleProgress >= 100) {
                showNotification('Módulo 1 completado', 'success');
                setTimeout(() => window.location.href = 'index.html', 3000);
            } else {
                showNotification('Lección completada', 'success');
                if (currentLesson < 3) setTimeout(() => loadLesson(currentLesson + 1), 2000);
            }
        }

        async function saveProgress() {
            const progressData = {
                progress: moduleProgress,
                completed: moduleProgress >= 100,
                completedLessons,
                evaluationScores,
                lastUpdate: new Date().toISOString()
            };
            const progressKey = `progress_${currentUser.username || currentUser.email}`;
            let userProgress = JSON.parse(window.localStorage.getItem(progressKey) || 'null');
            if (!userProgress) userProgress = { modules: {1:{},2:{},3:{}}, overallProgress: 0, lastActivity: new Date().toISOString() };
            userProgress.modules[1] = progressData;
            let totalProgress = 0;
            for (let id in userProgress.modules) totalProgress += userProgress.modules[id].progress || 0;
            userProgress.overallProgress = Math.round(totalProgress / 3);
            userProgress.lastActivity = new Date().toISOString();
            window.localStorage.setItem(progressKey, JSON.stringify(userProgress));
            try {
                if (typeof updateModuleProgress === 'function') await updateModuleProgress(1, progressData);
                if (typeof logUserActivity === 'function') logUserActivity('lesson_completed', currentUser, { moduleId: 1, lessonId: currentLesson, progress: moduleProgress });
            } catch (error) { console.error('Error:', error); }
        }

        function updateProgressDisplay() {
            document.getElementById('progressText').textContent = moduleProgress + '%';
            const bar = document.getElementById('moduleProgress');
            bar.style.width = moduleProgress + '%';
            bar.querySelector('span').textContent = moduleProgress + '%';
        }

        function updateSidebarProgress() {
            document.querySelectorAll('.lesson-link').forEach(link => {
                link.classList.remove('completed');
                if (completedLessons.includes(parseInt(link.getAttribute('data-lesson')))) link.classList.add('completed');
            });
        }

        async function loadModuleProgress() {
            try {
                if (typeof getStudentProgress === 'function') {
                    const sheetsProgress = await getStudentProgress(currentUser.username);
                    if (sheetsProgress?.modules?.[1]) {
                        moduleProgress = sheetsProgress.modules[1].progress || 0;
                        completedLessons = sheetsProgress.modules[1].completedLessons || [];
                        evaluationScores = sheetsProgress.modules[1].evaluationScores || {};
                        updateProgressDisplay();
                        updateSidebarProgress();
                        return;
                    }
                }
            } catch (error) { console.error('Error:', error); }
            const progressKey = `progress_${currentUser.username || currentUser.email}`;
            const userProgress = JSON.parse(window.localStorage.getItem(progressKey) || 'null');
            if (userProgress?.modules?.[1]) {
                moduleProgress = userProgress.modules[1].progress || 0;
                completedLessons = userProgress.modules[1].completedLessons || [];
                evaluationScores = userProgress.modules[1].evaluationScores || {};
            }
            updateProgressDisplay();
            updateSidebarProgress();
        }

        function showNotification(message, type = 'success') {
            const toastEl = document.getElementById('notificationToast');
            const toastIcon = document.getElementById('toastIcon');
            const icons = { success: 'bi-check-circle-fill text-success', warning: 'bi-exclamation-triangle-fill text-warning', error: 'bi-x-circle-fill text-danger' };
            toastIcon.className = icons[type] + ' me-2';
            document.getElementById('toastBody').textContent = message;
            new bootstrap.Toast(toastEl, { delay: 3000 }).show();
        }

        document.addEventListener('DOMContentLoaded', function() {
            if (typeof getCurrentUser !== 'undefined' && typeof protectPage !== 'undefined') {
                if (!protectPage()) return;
                currentUser = getCurrentUser();
            } else {
                const storedUser = window.localStorage.getItem('currentUser');
                if (storedUser) currentUser = JSON.parse(storedUser);
                else { window.location.href = 'login.html'; return; }
            }
            loadModuleProgress();
            loadLesson(1);
            if (typeof logUserActivity === 'function') logUserActivity('module_access', currentUser, { moduleId: 1, moduleTitle: 'Observación y Gesto' });
        });

        window.addEventListener('beforeunload', () => { if (moduleProgress > 0) saveProgress(); });
    </script>
</body>
</html>